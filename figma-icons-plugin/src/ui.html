<h2>Process SVG</h2>

<div id="react-page"></div>

<script>
  window.onmessage = async (event) => {
    if (event.data.pluginMessage.type === "networkRequest") {
      const data = [];
      for (const svg of event.data.pluginMessage.data) {
        const formData = new FormData();
        const file = new Blob([svg.data], {
          type: "image/svg+xml",
        });
        formData.append("file", file);
        const res = await fetch(
          `https://svg-optimizer.tools.dev.datapwn.com/process/${
            svg.size || "24"
          }`,
          {
            method: "POST",
            body: formData,
          }
        );
        const blob = await res.blob();
        const blobText = await blob.text();
        data.push({ ...svg , data: blobText });
      }
      window.parent.postMessage(
        {
          pluginMessage: {
            type: "create-svg",
            data,
            styleId: event.data.pluginMessage.styleId,
          },
        },
        "*"
      );
    }
  };
</script>
